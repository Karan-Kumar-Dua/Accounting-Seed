<template>
    <template if:true={isShowSpinner}>
        <lightning-spinner
                variant="brand"
                alternative-text={labels.commonLoading}
                size="medium">
        </lightning-spinner>
    </template>
    <div class="slds-var-m-bottom_medium">
        <c-page-header
            title={labels.multiLedgerDefaultsSubtitle}
            breadcrumbs={breadcrumbs}
            knowledge-base={knowledgeBase}
            icon-name="standard:custom"
        ></c-page-header>
    </div>
    <lightning-card if:false={userCanView}>
        <c-insufficient-privileges></c-insufficient-privileges>
    </lightning-card>
    <lightning-card if:true={userCanView}>
        <div slot="title" class="multiLedgerDefaults--header">
            <span class="slds-text-heading_small"
                ><strong>{labels.multiLedgerDefaultsTitle}</strong></span
            >
            <lightning-button-icon
                class="slds-var-m-left_medium"
                if:false={isEditable}
                icon-name="utility:edit"
                onclick={handleEdit}
                disabled={userCannotEdit}
                data-id="lightningButtonIcon-edit"
            ></lightning-button-icon>
            <lightning-button
                class="slds-var-m-left_medium"
                if:true={isEditable}
                label={labels.commonCancel}
                variant="neutral"
                onclick={handleCancel}
                disabled={userCannotEdit}
                data-id="lightningButton-cancel"
            ></lightning-button>
            <lightning-button
                class="slds-var-m-left_medium"
                if:true={isEditable}
                label={labels.commonSave}
                variant="brand"
                onclick={handleSave}
                disabled={userCannotEdit}
                data-id="lightningButton-save"
            ></lightning-button>
        </div>
        <div class="slds-var-p-around_medium">
            <table
                if:true={isLoaded}
                class="
                    slds-table slds-table_cell-buffer slds-table_bordered
                    automatedJobs--table
                "
                aria-labelledby="element-with-table-label other-element-with-table-label"
            >
                <thead class="multiLedgerDefaults--tableHeader">
                    <tr class="slds-line-height_reset">
                        <th class="" scope="col">
                            <div
                                class="slds-truncate"
                                title={ledgerInfo.fields.Name.label}
                            >
                                {ledgerInfo.fields.Name.label}
                            </div>
                        </th>
                        <th class="" scope="col">
                            <div
                                class="slds-truncate"
                                title={ledgerInfo.fields.Default_Bank_Account__c.label}
                            >
                                {ledgerInfo.fields.Default_Bank_Account__c.label}
                            </div>
                        </th>
                        <th class="" scope="col">
                            <div
                                class="slds-truncate"
                                title={ledgerInfo.fields.Default_Billing_Format__c.label}
                            >
                                {ledgerInfo.fields.Default_Billing_Format__c.label}
                            </div>
                        </th>
                        <th class="" scope="col">
                            <div
                                class="slds-truncate"
                                title={ledgerInfo.fields.Billing_Activity_Statement_Format__c.label}
                            >
                                {ledgerInfo.fields.Billing_Activity_Statement_Format__c.label}
                            </div>
                        </th>
                        <th class="" scope="col">
                            <div
                                class="slds-truncate"
                                title={ledgerInfo.fields.Billing_Outstanding_Statement_Format__c.label}
                            >
                                {ledgerInfo.fields.Billing_Outstanding_Statement_Format__c.label}
                            </div>
                        </th>
                        <th class="" scope="col">
                            <div
                                    class="slds-truncate"
                                    title={ledgerInfo.fields.Tax_Settings__c.label}
                            >
                                {ledgerInfo.fields.Tax_Settings__c.label}
                            </div>
                        </th>
                        <th class="" scope="col">
                            <div
                                    class="slds-truncate"
                                    title={ledgerInfo.fields.Sales_Tax_Company_Code__c.label}
                            >
                                {ledgerInfo.fields.Sales_Tax_Company_Code__c.label}
                            </div>
                        </th>
                        <th class="" scope="col" if:true={erpEnabled}>
                            <div
                                class="slds-truncate"
                                title={ledgerInfo.fields.Default_Packing_Slip_Format__c.label}
                            >
                                {ledgerInfo.fields.Default_Packing_Slip_Format__c.label}
                            </div>
                        </th>
                        <th class="" scope="col" if:true={erpEnabled}>
                            <div
                                class="slds-truncate"
                                title={ledgerInfo.fields.Default_Purchase_Order_Format__c.label}
                            >
                                {ledgerInfo.fields.Default_Purchase_Order_Format__c.label}
                            </div>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <template
                        for:each={ledgers}
                        for:item="ledger"
                        for:index="index"
                    >
                        <tr key={ledger.record.Id} class="slds-hint-parent">
                            <th
                                data-id="th-ledgerName"
                                data-label={ledgerInfo.fields.Name.label}
                                scope="row"
                            >
                                <div class="slds-truncate" title={ledger.record.Name}>
                                    <a
                                        class="multiLedgerDefaults--link"
                                        href={ledger.url}
                                        data-sfid={ledger.record.Id}
                                        >{ledger.record.Name}</a
                                    >
                                </div>
                            </th>
                            <td
                                data-id="td-startDate"
                                data-label={ledgerInfo.fields.Default_Bank_Account__c.label}
                            >
                                <div title={ledgerInfo.fields.Default_Bank_Account__c.label}>
                                    <c-record-popover
                                        if:true={isDisabled}
                                        record-id={ledger.record.Default_Bank_Account__c}
                                        object-api-name={glAccountObject}
                                        fields={glAccountFields}
                                        data-id="popover-defaultBankAccount"
                                    ></c-record-popover>
                                    <c-lookup-a
                                        if:false={isDisabled}
                                        search-object={glAccountObject}
                                        data-id="lookup-defaultBankAccount"
                                        data-lookup="Default_Bank_Account__c"
                                        data-index={index}
                                        init-value={ledger.record.Default_Bank_Account__c}
                                        search-filter={searchFilters.defaultBankAccount}
                                        onselectionchange={handleSelectionChange}
                                    >
                                    </c-lookup-a>
                                </div>
                            </td>
                            <td
                                data-id="td-nextRunDate"
                                data-label={ledgerInfo.fields.Default_Billing_Format__c.label}
                            >
                                <div title={ledgerInfo.fields.Default_Billing_Format__c.label}>
                                    <c-record-popover
                                        if:true={isDisabled}
                                        record-id={ledger.record.Default_Billing_Format__c}
                                        object-api-name={pdfFormatObject}
                                        fields={pdfFormatFields}
                                        data-id="popover-defaultBillingFormat"
                                    ></c-record-popover>
                                    <c-lookup-a
                                        if:false={isDisabled}
                                        search-object={pdfFormatObject}
                                        data-id="lookup-defaultBillingFormat"
                                        data-lookup="Default_Billing_Format__c"
                                        data-index={index}
                                        init-value={ledger.record.Default_Billing_Format__c}
                                        search-filter={searchFilters.defaultBillingFormat}
                                        onselectionchange={handleSelectionChange}
                                    >
                                    </c-lookup-a>
                                </div>
                            </td>
                            <td
                                data-id="td-preferredStartTime"
                                data-label={ledgerInfo.fields.Billing_Activity_Statement_Format__c.label}
                            >
                                <div title={ledgerInfo.fields.Billing_Activity_Statement_Format__c.label}>
                                    <c-record-popover
                                        if:true={isDisabled}
                                        record-id={ledger.record.Billing_Activity_Statement_Format__c}
                                        object-api-name={pdfFormatObject}
                                        fields={pdfFormatFields}
                                        data-id="popover-billingActivityStatementFormat"
                                    ></c-record-popover>
                                    <c-lookup-a
                                        if:false={isDisabled}
                                        search-object={pdfFormatObject}
                                        data-id="lookup-billingActivityStatementFormat"
                                        data-lookup="Billing_Activity_Statement_Format__c"
                                        data-index={index}
                                        init-value={ledger.record.Billing_Activity_Statement_Format__c}
                                        search-filter={searchFilters.billingActivityStatementFormat}
                                        onselectionchange={handleSelectionChange}
                                    >
                                    </c-lookup-a>
                                </div>
                            </td>
                            <td
                                data-id="td-action"
                                data-label={ledgerInfo.fields.Billing_Outstanding_Statement_Format__c.label}
                            >
                                <div title={ledgerInfo.fields.Billing_Outstanding_Statement_Format__c.label}>
                                    <c-record-popover
                                        if:true={isDisabled}
                                        record-id={ledger.record.Billing_Outstanding_Statement_Format__c}
                                        object-api-name={pdfFormatObject}
                                        fields={pdfFormatFields}
                                        data-id="popover-billingOutstandingStatementFormat"
                                        horizontal-arrangement="left"
                                    ></c-record-popover>
                                    <c-lookup-a
                                        if:false={isDisabled}
                                        search-object={pdfFormatObject}
                                        data-id="lookup-billingOutstandingStatementFormat"
                                        data-lookup="Billing_Outstanding_Statement_Format__c"
                                        data-index={index}
                                        init-value={ledger.record.Billing_Outstanding_Statement_Format__c}
                                        search-filter={searchFilters.billingOutstandingStatementFormat}
                                        onselectionchange={handleSelectionChange}
                                    >
                                    </c-lookup-a>
                                </div>
                            </td>
                            <td
                                    data-id="td-action"
                                    data-label={ledgerInfo.fields.Tax_Settings__c.label}
                            >
                                <div title={ledgerInfo.fields.Tax_Settings__c.label}>
                                    <c-record-popover
                                            if:true={isDisabled}
                                            record-id={ledger.record.Tax_Settings__c}
                                            object-api-name={taxSettingsObject}
                                            fields={taxSettingsFields}
                                            data-id="popover-taxSettings"
                                            horizontal-arrangement="left"
                                    ></c-record-popover>
                                    <c-lookup-a
                                            if:false={isDisabled}
                                            search-object={taxSettingsObject}
                                            data-id="lookup-taxSettings"
                                            data-lookup="Tax_Settings__c"
                                            data-index={index}
                                            init-value={ledger.record.Tax_Settings__c}
                                            retrieve-fields={retrieveFields}
                                            onselectionchange={handleSelectionChange}
                                    >
                                    </c-lookup-a>
                                </div>
                            </td>
                            <td
                                    data-id="td-action"
                                    data-label={ledgerInfo.fields.Sales_Tax_Company_Code__c.label}
                            >
                                <div title={ledgerInfo.fields.Sales_Tax_Company_Code__c.label}>
                                    <template if:false={ledger.isSalesTaxCompanyCodeDisabled}>
                                        <lightning-input
                                            value={ledger.record.Sales_Tax_Company_Code__c}
                                            data-id="input-salesTaxCompanyCode"
                                            data-input="Sales_Tax_Company_Code__c"
                                            data-index={index}
                                            if:false={isDisabled}
                                            type="text"
                                            max-length="50"
                                            variant="label-hidden"
                                            disabled={ledger.isSalesTaxCompanyCodeDisabled}
                                            onchange={handleSalesTaxCompanyCodeChange}>
                                        </lightning-input>
                                    </template>
                                    <template if:true={ledger.isSalesTaxCompanyCodeDisabled}>
                                        <lightning-input
                                            data-id="input-salesTaxCompanyCode"
                                            data-input="Sales_Tax_Company_Code__c"
                                            data-index={index}
                                            if:false={isDisabled}
                                            type="text"
                                            max-length="50"
                                            variant="label-hidden"
                                            disabled={ledger.isSalesTaxCompanyCodeDisabled}
                                            onchange={handleSalesTaxCompanyCodeChange}>
                                        </lightning-input>
                                    </template>
                                    <div if:true={isDisabled} class="slds-form-element__static">
                                        <template if:false={ledger.isSalesTaxCompanyCodeDisabled}>
                                            {ledger.record.Sales_Tax_Company_Code__c}
                                        </template>
                                    </div>
                                </div>
                            </td>
                            <td
                                data-id="td-action"
                                data-label={ledgerInfo.fields.Default_Packing_Slip_Format__c.label}
                                if:true={erpEnabled}
                            >
                                <div title={ledgerInfo.fields.Default_Packing_Slip_Format__c.label}>
                                    <c-record-popover
                                        if:true={isDisabled}
                                        record-id={ledger.record.Default_Packing_Slip_Format__c}
                                        object-api-name={pdfFormatObject}
                                        fields={pdfFormatFields}
                                        data-id="popover-defaultPackingSlipFormat"
                                        horizontal-arrangement="left"
                                    ></c-record-popover>
                                    <c-lookup-a
                                        if:false={isDisabled}
                                        search-object={pdfFormatObject}
                                        data-id="lookup-defaultPackingSlipFormat"
                                        data-lookup="Default_Packing_Slip_Format__c"
                                        data-index={index}
                                        init-value={ledger.record.Default_Packing_Slip_Format__c}
                                        search-filter={searchFilters.defaultPackingSlipFormat}
                                    >
                                    </c-lookup-a>
                                </div>
                            </td>
                            <td
                                data-id="td-action"
                                data-label={ledgerInfo.fields.Default_Purchase_Order_Format__c.label}
                                if:true={erpEnabled}
                            >
                                <div title={ledgerInfo.fields.Default_Purchase_Order_Format__c.label}>
                                    <c-record-popover
                                        if:true={isDisabled}
                                        record-id={ledger.record.Default_Purchase_Order_Format__c}
                                        object-api-name={pdfFormatObject}
                                        fields={pdfFormatFields}
                                        data-id="popover-defaultPurchaseOrderFormat"
                                        horizontal-arrangement="left"
                                    ></c-record-popover>
                                    <c-lookup-a
                                        if:false={isDisabled}
                                        search-object={pdfFormatObject}
                                        data-id="lookup-defaultPurchaseOrderFormat"
                                        data-lookup="Default_Purchase_Order_Format__c"
                                        data-index={index}
                                        init-value={ledger.record.Default_Purchase_Order_Format__c}
                                        search-filter={searchFilters.defaultPurchaseOrderFormat}
                                    >
                                    </c-lookup-a>
                                </div>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
    </lightning-card>
</template>